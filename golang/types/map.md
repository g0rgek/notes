# Old (buckets, before 1.24)
## Map type
```go
// Type contains types for key and value for this map
type mapType struct{
	key   *_type // –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Ç–∏–ø–∞
	value *_type // –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Ç–∏–ø–∞
	//...
	hasher func(unsafe.Pointer, uintptr) uintptr
}
```
[Source code](https://github.com/golang/go/blob/ba913774543d7388b7bb1843fc7c1b935aebedda/src/runtime/type.go#L356)

```go
// Type descriptor inside map
type _type struct{
	size uintptr
	...
	equal() bool
}
```
## Map header
```go
// Map header
type hmap struct {
	// Note: the format of the hmap is also encoded in cmd/compile/internal/reflectdata/reflect.go.
	// Make sure this stays in sync with the compiler's definition.
	count     int // # live cells == size of map.  Must be first (used by len() builtin)
	flags     uint8
	B         uint8  // log_2 of count of buckets (can hold up to loadFactor * 2^B items)
	noverflow uint16 // approximate number of overflow buckets; see incrnoverflow for details
	hash0     uint32 // hash seed

	buckets    unsafe.Pointer // array of 2^B Buckets. may be nil if count==0.
	oldbuckets unsafe.Pointer // previous bucket array of half the size, non-nil only when growing
	nevacuate  uintptr        // progress counter for evacuation (buckets less than this have been evacuated)

	extra *mapextra // optional fields
}
```
### –û–ø–µ—Ä–∞—Ü–∏–∏ —Å nil map
1. –ß—Ç–µ–Ω–∏–µ  - zero value
2. –ó–∞–ø–∏—Å—å - panic (assign to nil map)
## Concurrency 
–ù–∞—á–∏–Ω–∞—è —Å `go 1.8`, –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ map –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è [mutex](concurrency/mutex.md) –∏–ª–∏ [4.2 atomic](4.2%20atomic.md) –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ fatal error. 

```md
Maps are not safe for concurrent use: it's not defind what happens when you read and write to them simultaneously.
If you need to read from and write to map from goroutines, the access must be mediated by some kind of synchronization mechanim.
```

–†–∞–∑–Ω–∏—Ü–∞ —Å [sync.Map](sync.Map.md)
## –û–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –º–∞–ø–æ–π
###  nil map
- –∑–∞–ø–∏—Å—å - panic
- —á—Ç–µ–Ω–∏–µ - ok
- delete(k,v) - ok
- range - ok
### runtime
```go
v := m["k"] -> func mapaccess1(t *maptype, h *hmap, k unsafe.Pointer) unsafe.Pointer // –¥–æ—Å—Ç—É–ø –ø–æ –∫–ª—é—á—É, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ

v, ok := m["k"] -> func mapaccess2(t *maptype, h *hmap, k unsafe.Pointer) (unsafe.Pointer, bool) // –¥–æ—Å—Ç—É–ø –ø–æ –∫–ª—é—á—É, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏ —Ñ–ª–∞–≥ –Ω–∞–ª–∏—á–∏—è

m["k"] = 9001 -> func mappassign(t *maptype, h *hmap, k unsafe.Pointer) unsafe.Pointer // –∑–∞–ø–∏—Å—å –ø–æ –∫–ª—é—á—É

delete(m, "k") -> func mapdelete(t *maptype, h *hmap, k unsafe.Pointer) 
// —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É
```
–¢–∞–∫ –∫–∞–∫ –º–∞–ø–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –¥–∂–µ–Ω–µ—Ä–∏–∫–∞—Ö:
```go
v = m[k]
//  |
//  V
pk = unsafe.Pointer(&k)
pv := runtime.lookup(typeOf(m), m, pk)
v = *(*V)pv // —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞—Å—Ç–∏–º unsafe.Pointer –∫ –Ω—É–∂–Ω–æ–º—É —Ç–∏–ø—É, —Ä–∞–∑—ã–º–µ–Ω–æ–≤—ã–≤–∞–µ–º
```
## Buckets
```
                                               buckets              
                                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                    ‚îÇ     ‚îÇ ‚îÇ     ‚îÇ ‚îÇ     ‚îÇ  ‚îÇ     ‚îÇ
                                    ‚îÇ  0  ‚îÇ ‚îÇ  1  ‚îÇ ‚îÇ  2  ‚îÇ  ‚îÇ  3  ‚îÇ
                                    ‚îÇ     ‚îÇ ‚îÇ     ‚îÇ ‚îÇ     ‚îÇ  ‚îÇ     ‚îÇ
                                    ‚îÇ     ‚îÇ ‚îÇ     ‚îÇ ‚îÇ     ‚îÇ  ‚îÇ     ‚îÇ
                                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ                    
‚îÇ tophash       key       value    ‚îÇ           ‚îÇ                    
‚îÇ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ           ‚îÇ                    
‚îÇ‚îÇ 110110 ‚îÇ ‚îÇ    1    ‚îÇ‚îÇ   10    ‚îÇ ‚îÇ           ‚îÇ                    
‚îÇ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ| |‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ||‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ           ‚îÇ                    
‚îÇ‚îÇ 110101 ‚îÇ ‚îÇ   42    ‚îÇ‚îÇ   427   ‚îÇ ‚îÇ           ‚îÇ                    
‚îÇ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ| |‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ||‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ           ‚îÇ                    
‚îÇ‚îÇ        ‚îÇ ‚îÇ         ‚îÇ‚îÇ         ‚îÇ ‚îÇ           ‚îÇ                    
‚îÇ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ| |‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ||‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ           ‚îÇ                    
‚îÇ‚îÇ        ‚îÇ ‚îÇ         ‚îÇ‚îÇ         ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    
‚îÇ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ| |‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ||‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ                                
‚îÇ‚îÇ        ‚îÇ ‚îÇ         ‚îÇ‚îÇ         ‚îÇ ‚îÇ                                
‚îÇ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ| |‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ||‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ                                
‚îÇ‚îÇ        ‚îÇ ‚îÇ         ‚îÇ‚îÇ         ‚îÇ ‚îÇ                                
‚îÇ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ| |‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ||‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ                                
‚îÇ‚îÇ        ‚îÇ ‚îÇ         ‚îÇ‚îÇ         ‚îÇ ‚îÇ                                
‚îÇ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ| |‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ||‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ                                
‚îÇ‚îÇ        ‚îÇ ‚îÇ         ‚îÇ‚îÇ         ‚îÇ ‚îÇ                                
‚îÇ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ                                
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                
```

```go
type bmap struct {
    tophash [bucketCnt]uint8     // HighOrderBits hash –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    keys    [bucketCnt]keyType   // –ú–∞—Å—Å–∏–≤ –∫–ª—é—á–µ–π
    values  [bucketCnt]valueType // –ú–∞—Å—Å–∏–≤ –∑–Ω–∞—á–µ–Ω–∏–π
    overflow *bmap               // –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –±–∞–∫–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è
}
```
Buckets - –º–∞—Å—Å–∏–≤ –æ–¥–Ω–æ—Å–≤—è–∑–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤. 
–ü–æ—Ä—è–¥–æ–∫ –∏—Ç–µ—Ä–∞—Ü–∏–π –ø–æ –Ω–∏–º –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω: —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ö—ç—à —Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –≤ –∏–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Å–¥–µ–ª–∞–ª–∏ –∏—Ç–µ—Ä–∞—Ü–∏—é –ø–æ –º–∞—Å—Å–∏–≤—É –±–∞–∫–µ—Ç–æ–≤ —Å–ª—É—á–∞–π–Ω–æ–π, —á—Ç–æ–±—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞–ª–∏—Å—å –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Ö—ç—à–º–∞–ø—ã.

–ö–ª—é—á –º–∞–ø—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å comparable. –ü–æ—ç—Ç–æ–º—É —Å–ª–∞–π—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–ª—é—á–æ–º –º–∞–ø—ã.
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–ª—é—á–æ–º, –ø–æ–∫–∞ –≤—Å–µ –ø–æ–ª—è –≤ –Ω–µ–π - comparable.

–ù–µ–ª—å–∑—è –≤–∑—è—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç –º–∞–ø—ã, —Ç–∞–∫ –∫–∞–∫ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ —ç–≤–∞–∫—É–∞—Ü–∏—è –∏ —É–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–∞–Ω–µ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º.

–í –∫–∞–∂–¥–æ–º –±–∞–∫–µ—Ç–µ –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–µ –±–æ–ª–µ–µ 8 —ç–ª–µ–º–µ–Ω—Ç–æ–≤: 
–ú–∞—à–∏–Ω–Ω–æ–µ —Å–ª–æ–≤–æ - 8 –±–∞–π—Ç, –ø–æ—ç—Ç–æ–º—É 8 –±–∞–∫–µ—Ç–æ–≤. 
## –ê–ª–≥–æ—Ä–∏—Ç–º —á—Ç–µ–Ω–∏—è
–ß—Ç–µ–Ω–∏–µ –≤—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Ä–∞–Ω–¥–æ–º–Ω–æ–≥–æ –±–∞–∫–µ—Ç–∞. –¢–∞–∫ –∫–∞–∫ SEED  –¥–ª—è –∫–∞–∂–¥–æ–π –º–∞–ø—ã –æ—Ç –∑–∞–ø—É—Å–∫–∞ –∫ –∑–∞–ø—É—Å–∫—É –º–µ–Ω—è–µ—Ç—Å—è, –¥–∞–Ω–Ω—ã–µ –ø–æ –º–∞–ø–µ —Ä–∞—Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è —Ä–∞–Ω–¥–æ–º–Ω–æ. –ü–æ—ç—Ç–æ–º—É —Ä–∞–Ω–æ–º–Ω—ã–π –≤—ã–±–æ—Ä –±–∞–∫–µ—Ç–∞ –∑–∞—Ö–∞—Ä–∫–æ–∂–µ–Ω –≤ —è–∑—ã–∫–µ, –æ–±—ä—è—Å–Ω—è–µ—Ç—Å—è —Ç–µ–º _—á—Ç–æ–±—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –Ω–µ –ø–æ–ª–∞–≥–∞–ª–∏—Å—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π, —Ç–∞–∫ –∫–∞–∫ –±—É–¥—É—â–µ–º –≤—Å–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è._
–ù–û, `fmt.Println()` –≤—ã–≤–æ–¥–∏—Ç –º–∞–ø—É –≤ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –ø–æ –∫–ª—é—á—É –ø–æ—Ä—è–¥–∫–µ.
### –®–∞–≥–∏
0. –ï—Å–ª–∏ map == nil –∏–ª–∏ –ø—É—Å—Ç–∞—è - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è zerovalue
1. –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è hash –¥–ª—è –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞: `hash(1) = 1010101...001`
2. –í—ã—á–∏—Å–ª—è–µ–º `LowOrderBits` (–ø–æ—Å–ª–µ–¥–Ω–∏–µ N –±–∏—Ç–æ–≤ —Ö—ç—à–∞): `LOB = log2(num_buckets)`. 
	LOB –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∏–Ω–¥–µ–∫—Å –±–∞–∫–µ—Ç–∞, –≤ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ.
3. –ü—Ä–æ–≤–µ—Ä—è–µ–º old buckets - –µ—Å–ª–∏ –º–∞–ø–∞ –±—ã–ª–∞ —ç–≤–∞–∫—É–∏—Ä–æ–≤–∞–Ω–∞
4. –ö–æ–ø–∏—Ä—É–µ–º tophash (–ø–µ—Ä–≤—ã–π –±–∞–π—Ç) —Ö—ç—à–∞, –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –∫–ª—é—á–∞ –≤ –±–∞–∫–µ—Ç–µ.
5. –ü—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ –≤—Å–µ–º –±–∞–∫–µ—Ç–∞–º, —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º tophash. –ï—Å–ª–∏ –Ω–∞—à–ª–∏ —Ç–∞–∫–æ–π - —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –∫–ª—é—á –µ—Å—Ç—å –≤ –±–∞–∫–µ—Ç–µ.
6. –ü—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ –º–∞—Å—Å–∏–≤—É keys, —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º.
7. –ï—Å–ª–∏ –Ω–∞—à–ª–∏  - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º.
7. –ï—Å–ª–∏ –Ω–µ—Ç - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º zero value
–ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä –ø–æ —Å–ª–∞–π—Å—É –≤—Å–µ–≥–¥–∞ –±—ã—Å—Ç—Ä–µ–µ –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ–±–æ—Ä–∞ –ø–æ map, –∞ –Ω–µ –≤ –∫–∞–∫–∏—Ö-—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö. –î–∞–∂–µ –±–µ–∑ –≤—Å—è–∫–∏—Ö –∫–µ—à–µ–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞, —Ç–∞–º –∂–µ –æ–±–≤—è–∑–∫–∞ —Å —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏–µ–π. –ï—Å–ª–∏ –±—ã –≤–æ–ø—Ä–æ—Å –±—ã–ª –Ω–∞–æ–±–æ—Ä–æ—Ç - –±—ã–≤–∞–µ—Ç –ª–∏ –ø–µ—Ä–µ–±–æ—Ä –ø–æ —Å–ª–∞–π—Å—É –±—ã—Å—Ç—Ä–µ–µ –¥–æ—Å—Ç—É–ø–∞ –ø–æ –∫–ª—é—á—É –∫ map - –∏ —Ç—É—Ç —É–∂–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–≤–µ—Ç –¥–∞ –≤ –æ—Å–æ–±—ã—Ö —Å–ª—É—á–∞—è—Ö, –Ω–∞ map –º–µ–Ω—å—à–µ 8.
### –°–ª–æ–∂–Ω–æ—Å—Ç—å (O(1)->O(N))
1. hash(1) - O(1)
2. LOB(hash(1)) - O(1)
3. tophash = hash first byte - O(1)
4. —Å—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ–º tophash - O(8) = O(1)
5. —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º keys - O(8) = O(1)
6. –ü–æ–ª—É—á–∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —Ç–∞–∫–æ–º—É –∂–µ –∏–Ω–¥–µ–∫—Å—É, –∫–∞–∫ –∫–ª—é—á - O(1)
–ò—Ç–æ–≥: O(1)
–í—Å–µ–≥–¥–∞ –ª–∏ —Ç–∞–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å - **–ù–ï–¢**. –ï—Å–ª–∏ LOB —Å–æ–ø–∞–¥–µ—Ç —Å –±–∞–∫–µ—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω, —Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è –µ—â–µ –æ–¥–∏–Ω –±–∞–∫–µ—Ç. –ò —Å—Å—ã–ª–∫–∞ –Ω–∞ –Ω–µ–≥–æ –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –ø–æ–ª–µ `overflow` —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∫–µ—Ç–∞. –í —Ö—É–¥—à–µ–º —Å–ª—É—á–∞–µ, –ø–æ–ª—É—á–∏–º O(N).
## –ê–ª–≥–æ—Ä–∏—Ç–º –∑–∞–ø–∏—Å–∏
–ß—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å KV –≤ –º–∞–ø—É, –∫–ª—é—á (K) –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å [COMPARABLE](1.2%20uncomparable%20types.md). –ü–æ-–ø—Ä–æ—Å—Ç–æ–º—É, –¥–ª—è –Ω–µ–≥–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –æ–ø–µ—Ä–∞—Ç–æ—Ä —Å—Ä–∞–≤–Ω–µ–Ω–∏—è `==`. –ù–µ –≤—Å–µ —Ç–∏–ø—ã —è–≤–ª—è—é—Ç—Å—è comparable –ø–æ —Ç–æ–π –∏–ª–∏ –∏–Ω–æ–π –ø—Ä–∏—á–∏–Ω–µ.
### –®–∞–≥–∏
```go
m := make(map[int]int)
m[1] = 10
```
1. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º hash –æ—Ç –∫–ª—é—á–∞: `hash(1) = 1010101...001`
2. –í –∫–∞–∫–æ–π –±–∞–∫–µ—Ç –ø–æ–ª–æ–∂–∏—Ç—å —ç—Ç–∏ kv? –ë–µ—Ä–µ—Ç LOB (low order bits) –æ—Ç —Ö—ç—à–∞ - –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –±–∏—Ç.
	N —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ: `N = log2(num_buckets) = 3`
	–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ, LOB=001 = 1. –ó–Ω–∞—á–∏—Ç –∏–Ω–¥–µ–∫—Å –±–∞–∫–µ—Ç–∞ –≤ –º–∞—Å—Å–∏–≤–µ buckets = 1.
3. –í –º–∞—Å—Å–∏–≤ tophash –∫–ª–∞–¥–µ–º –ø–µ—Ä–≤—ã–π –±–∞–π—Ç —Ö—ç—à–∞. –ù—É–∂–µ–Ω –æ–Ω –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –µ—Å—Ç—å –ª–∏ (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ) —Ç–∞–∫–æ–π kv –≤ —ç—Ç–æ–º –±–∞–∫–µ—Ç–µ.
4. –í –º–∞—Å—Å–∏–≤ keys –∫–ª–∞–¥–µ–º –∫–ª—é—á
5. –í –º–∞—Å—Å–∏–≤ values –∫–ª–∞–¥–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
### –°–ª–æ–∂–Ω–æ—Å—Ç—å (O(1) -> O(N))
1. hash(1) - O(1)
2. LOB(hash(1)) - O(1)
3. tophash = hash first byte - O(1)
4. append(tophash) - O(1)
5. append(keys) & append(values) - O(1)
–ò—Ç–æ–≥: O(1)
–í—Å–µ–≥–¥–∞ –ª–∏ —Ç–∞–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å - **–ù–ï–¢**. –ï—Å–ª–∏ LOB —Å–æ–ø–∞–¥–µ—Ç —Å –±–∞–∫–µ—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω, —Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è –µ—â–µ –æ–¥–∏–Ω –±–∞–∫–µ—Ç. –ò —Å—Å—ã–ª–∫–∞ –Ω–∞ –Ω–µ–≥–æ –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –ø–æ–ª–µ `overflow` —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∫–µ—Ç–∞. –í —Ö—É–¥—à–µ–º —Å–ª—É—á–∞–µ, –ø–æ–ª—É—á–∏–º O(N).


## –ê–ª–≥–æ—Ä–∏—Ç–º –æ—á–∏—Å—Ç–∫–∏
- –ø—Ä–∏—Ä–∞–≤–Ω—è—Ç—å nil ([5. GC](5.%20GC.md) –æ—Å–≤–æ–±–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –≤—Ä–µ–º—è)
- –≤ —Ü–∏–∫–ª–µ –≤—ã–∑–≤–∞—Ç—å `delete(key, value)` ([5. GC](5.%20GC.md) –Ω–µ –æ—Å–≤–æ–±–æ–¥–∏—Ç)
- –≤—ã–∑–≤–∞—Ç—å `clear(map)` ([5. GC](5.%20GC.md) –Ω–µ –æ—Å–≤–æ–±–æ–¥–∏—Ç)
```go
package main

import "fmt"

func main() {
	// remove all elements
	first := map[int]int{1: 1, 2: 2, 3: 3}
	first = nil
	fmt.Println(first, " : ", len(first))

	// keep allocated memory
	second := map[int]int{1: 1, 2: 2, 3: 3}
	for key := range second {
		delete(second, key)
	}
	fmt.Println(second, " : ", len(second))

	// keep allocated memory
	third := map[int]int{1: 1, 2: 2, 3: 3}
	clear(third)
	fmt.Println(third, " : ", len(third))
}
```
## Float –∫–∞–∫ –∫–ª—é—á
Float –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–∞ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏–∑-–∑–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —á–∏—Å–µ–ª —Å –ø–ª–∞–≤–∞—é—â–µ–π –∑–∞–ø—è—Ç–æ–π. –ü—Ä–∏ —Å–ª–æ–∂–µ–Ω–∏–∏ –±–æ–ª—å—à–∏—Ö float, –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å NAN. –ù–æ NAN –Ω–µ —Ä–∞–≤–Ω–æ NAN.
```go
package main

import "fmt"

func main() {

  // declare map with float based key
  m := make(map[float32]struct{})

  // write two different key
  m[999999999999999999999999999] = struct{}{}
  m[999999999999999999999999998] = struct{}{}

  // check len and see one but not two keys
  fmt.Println("keys count:", len(m)) // keys count: 1
}
```

–†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ —Å –º–∞–ª–µ–Ω—å–∫–∏–º–∏ —á–∏—Å–ª–∞–º–∏:
```go
package main

import "fmt"

func main() {
  var val1 float32 = 0.3
  var val2 float32 = 0.6

  // declare map with float based key
  m := make(map[float32]struct{})

  m[val1+val2] = struct{}{}

  var result float32 = 0.9
  _, ok := m[result]
  
  fmt.Println(ok) // false
}
```
1. –§–∏–Ω–∞–Ω—Å—ã –ª—É—á—à–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö –≤–∞–ª—é—Ç—ã (–†—É–±–ª—å - –∫–æ–ø–µ–π–∫–∞, –î–æ–ª–ª–∞—Ä - —Ü–µ–Ω—Ç), —á—Ç–æ–±—ã —á–∏—Å–ª–æ –±—ã–ª–æ —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã–º.
2. –ú–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ int: –≤—ã–¥–µ–ª–∏—Ç—å 6 –±–∞–π—Ç –ø–æ–¥ —Ä—É–±–ª–∏ –∏ 2 –±–∞–π—Ç–∞ –ø–æ–¥ –∫–æ–ø–µ–π–∫–∏
## [any](interface#Empty%20interface%20(any)) –∫–∞–∫ –∫–ª—é—á
–ù—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ –µ—Å—Ç—å [1.2 uncomparable types](1.2%20uncomparable%20types.md) —Ç–∏–ø—ã, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –æ–ø–µ—Ä–∞—Ç–æ—Ä `==` –∏ —Ñ—É–Ω–∫—Ü–∏—è —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è.
–ù–∞–ø–æ–º–Ω–∏–º, —á—Ç–æ —Ç–∏–ø [slice –Ω–µ comparable](slice#Slice%20is%20not%20comparable%20(cant%20use%20as%20key%20in%20map)). –ù–æ –æ–Ω —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç —Ç–∏–ø—É `any (–ø—É—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)`. –ù–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –º—ã –Ω–µ —É–∑–Ω–∞–µ–º –æ–± –æ—à–∏–±–∫–µ. 
–ù–æ –≤ —Ä–∞–Ω—Ç–∞–π–º–µ, –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å–ª–∞–π—Å–∞ –∫–∞–∫ –∫–ª—é—á–∞ –≤ –º–∞–ø–µ, –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç [–ø–∞–Ω–∏–∫–∞](2.1%20panic%20–∏%20recover.md#panic>).
```go
package main

func main() {
	var data []int
	dictionary := make(map[interface{}]struct{})
	dictionary[data] = struct{}{} // panic: hash of unshashable type []int
}
```
## Map in not comparable
–ü–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å–æ [slice](slice.md), –º–∞–ø–∞ —Ç–æ–∂–µ —è–≤–ª—è–µ—Ç—Å—è [–Ω–µ—Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º–æ–π](1.2%20uncomparable%20types.md).
1. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø—Ä–∏—Ä–æ–¥–∞ –º–∞–ø—ã: —ç—Ç–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å—Å—è –∏ —É–º–µ–Ω—å—à–∞—Ç—å—Å—è –ø–æ –º–µ—Ä–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è –ø–∞—Ä –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ.
2. –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: –≤–Ω—É—Ç—Ä  —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–∞–ø—ã –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–∞–∫–µ—Ç—ã. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —ç—Ç–∏–º –≤–µ–¥—Ä–∞–º –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ –¥–≤–µ –∫–∞—Ä—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–∞—Ä—ã –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ. 
3. –†–∞–Ω–¥–æ–º –ø–æ—Ä—è–¥–æ–∫: –ø–æ—Ä—è–¥–æ–∫ –∏—Ç–µ—Ä–∞—Ü–∏–π –ø–æ –∫–ª—é—á–∞–º –∫–∞—Ä—Ç –≤ Go –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ —Ä–∞–Ω–¥–æ–º–∏–∑–∏—Ä–æ–≤–∞–Ω.
4. –ú—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å
–ü—Ä–æ–±–ª–µ–º—ã —Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç —ç–ª–µ–º–µ–Ω—Ç –∑–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–∏—Ö –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–∞—Ä—Ç. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–±–æ—Ä–∞ –≤—Å–µ—Ö –ø–∞—Ä –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ –∏ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –æ–±–µ –∫–∞—Ä—Ç—ã —Å–æ–¥–µ—Ä–∂–∞–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–∞—Ä—ã, —á—Ç–æ –º–æ–∂–µ—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º.
## –≠–≤–∞–∫—É–∞—Ü–∏—è
–ù–µ–ª—å–∑—è –ø–æ–ª—É—á–∏—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç –º–∞–ø—ã –∏–∑-–∑–∞ —ç–≤–∞–∫—É–∞—Ü–∏–∏. –ú–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –ø–µ—Ä–µ–µ—Ö–∞–ª –∏ —Å—Å—ã–ª–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–π.

–ö–æ–≥–¥–∞ —Å—Ä–µ–¥–Ω—è—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –±–∞–∫–µ—Ç–æ–≤ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è 6.5 (80%), –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —ç–≤–∞–∫—É–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –±–∞–∫–µ—Ç–æ–≤.
- –í–æ –≤—Ä–µ–º—è —ç–≤–∞–∫—É–∞—Ü–∏–∏, –º–∞–ø–∞ –¥–µ—Ä–∂–∏—Ç 2 —É–∫–∞–∑–∞—Ç–µ–ª—è –Ω–∞ 2 –º–∞—Å—Å–∏–≤–∞ –±–∞–∫–µ—Ç–æ–≤: `buckets` –∏ `old_buckets`.
- –ú–∞—Å—Å–∏–≤ `buckets` —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤ –¥–≤–∞ —Ä–∞–∑–∞.
- –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –≤–æ—Ä–∫–µ—Ä–æ–≤.
- –í–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏/—É–¥–∞–ª–µ–Ω–∏—è –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–∞–∫–µ—Ç–æ–≤.
- –†–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, –∫–æ–≥–¥–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –±–∞–∫–µ—Ç–æ–≤) –ø—Ä–µ–≤—ã—à–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ø–æ—Ä–æ–≥, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é —Ä–∞–∑–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã.
- –ü–æ –º–µ—Ä–µ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –º–∞–ø–µ –º–æ–∂–µ—Ç —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å—Å—è —á–∏—Å–ª–æ –∫–æ–ª–ª–∏–∑–∏–π (–∫–æ–≥–¥–∞ —Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ —Ö—ç—à–∏—Ä—É—é—Ç—Å—è –≤ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –±–∞–∫–µ—Ç), —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Å–Ω–∏–∂–µ–Ω–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. 
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ä–∞–∑—É, Go –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥: —ç–ª–µ–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è —á–∞—Å—Ç—è–º–∏ –ø–æ –º–µ—Ä–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –≤—Å—Ç–∞–≤–æ–∫ –∏ —É–¥–∞–ª–µ–Ω–∏–π. 
## If key/value size > 128 byte
Map will store pointer to this key or value and want store inside buckets
https://vivasoftltd.com/golang-mistakes-1-maps-and-memory-leaks/
## –°–≤–æ–π—Å—Ç–≤–∞ —Ö—ç—à-—Ñ—É–Ω–∫—Ü–∏–∏:
1. –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º (–¥–ª—è –≤—Ö–æ–¥–∞ X –≤—Å–µ–≥–¥–∞ –≤—ã—Ö–æ–¥ Y)
2. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–±—ã—Å—Ç—Ä–∞—è –≤—ã—á–∏—Å–ª–∏–º–æ—Å—Ç—å)
3. –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å (–±–ª–∏–∑–∫–∏–µ —Ö—ç—à–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –≤ —Ä–∞–∑–Ω—ã–µ –º–µ—Å—Ç–∞)
4. –ö—Ä–∏–ø—Ç–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å (—Å–ª–æ–∂–Ω–æ –ø–æ–¥–æ–±—Ä–∞—Ç—å –∫–ª—é—á–∏, —á—Ç–æ–±—ã –æ–Ω–∏ –ø–æ–ø–∞–ª–∏ –≤ –æ–¥–∏–Ω –±–∞–∫–µ—Ç)
## –ú–µ—Ç–æ–¥—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–ª–ª–∏–∑–∏–π 
1. –û—Ç–∫—Ä—ã—Ç–∞—è –∞–¥—Ä–µ—Å–∞—Ü–∏—è (–∫–ª–∞–¥–µ–º –≤ —Å–ª–µ–¥—É—é—â—É—é —è—á–µ–π–∫—É/–≤—ã—á–∏—Å–ª—è–µ–º –ø–æ —Ñ–æ—Ä–º—É–ª–µ)
2. –ú–µ—Ç–æ–¥ —Ü–µ–ø–æ—á–µ–∫ (–º–∞—Å—Å–∏–≤ –æ–¥–Ω–æ—Å–≤—è–∑–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤)
3. –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Ç–æ—Ä—É—é —Ö—ç—à-—Ñ—É–∫–Ω—Ü–∏—é
4. –†–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
## –ü—Ä–æ–±–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ö—ç—à–∞)
1. –õ–∏–Ω–µ–π–Ω–æ–µ
2. –ö–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–µ
3. –î–≤–æ–π–Ω–æ–µ
## –ü–ª–∞–Ω –æ—Ç–≤–µ—Ç–∞
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–¥ –∫–æ—Ç–æ—Ä–æ–π –º–∞—Å—Å–∏–≤ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ –±–∞–∫–µ—Ç—ã
- len() –Ω–µ –æ–±—Ö–æ–¥–∏—Ç –º–∞–ø—É –∏ –ø–æ—á–µ–º—É (–≤ —Ö–µ–¥–µ—Ä–µ –µ—Å—Ç—å –ø–æ–ª–µ count)
- —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∫–µ—Ç–æ–≤
- –Ω–∞–ª–∏—á–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ –±–∞–∫–µ—Ç—ã –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è
- –∫–æ–ª–ª–∏–∑–∏–∏ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å average - O(1) –∏ the worst - O(N/8) => O(N)
- –∫–ª—é—á–∏ –Ω–µ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã –∏ –Ω–µ –º–æ–≥—É—Ç —Ç–∞–∫–∏–º–∏ –±—ã—Ç—å
- —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–ª—é—á–µ–º, –ø–æ—á–µ–º—É float –ª—É—á—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –∫–ª—é—á
- –Ω–∞–ª–∏—á–∏–µ —ç–≤–∞–∫—É–∞—Ü–∏–∏
- syn—Å map –∏ –ø—Ä–æ –Ω–µ–µ –µ—â–µ –º–∏–Ω—É—Ç –Ω–∞ 4-6 —Å–ø–∏—á
# New(Swiss, after 1.24)
## Set performance loss
[Source](https://rushter.com/blog/go-and-hashmaps/)
[Issue](https://github.com/golang/go/issues/71368) 

–í go –Ω–µ—Ç ¬´—Ä–æ–¥–Ω–æ–≥–æ¬ª —Ç–∏–ø–∞ ¬´–º–Ω–æ–∂–µ—Å—Ç–≤–æ¬ª (set). B–º–µ—Å—Ç–æ –Ω–µ–≥–æ `map[T]struct{}`:
```go
set := make(map[string]struct{})
set["apple"] = struct{}{}
if _, exists := set["apple"]; exists {
  fmt.Println("‚úì apple")
}
```

–ü—Ä–µ–ª–µ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è [struct#–ü—É—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞](struct#–ü—É—Å—Ç–∞—è%20—Å—Ç—Ä—É–∫—Ç—É—Ä–∞.md) –≤ —Ç–æ–º, —á—Ç–æ —É —Ç–∞–∫–æ–π –∫–∞—Ä—Ç—ã –∑–Ω–∞—á–µ–Ω–∏—è –±—É–∫–≤–∞–ª—å–Ω–æ –∑–∞–Ω–∏–º–∞—é—Ç 0 –±–∞–π—Ç.

–í Go 1.24 `map[T]struct{}` —Ç–µ–ø–µ—Ä—å –∑–∞–Ω–∏–º–∞–µ—Ç —Ä–æ–≤–Ω–æ —Å—Ç–æ–ª—å–∫–æ –∂–µ –ø–∞–º—è—Ç–∏, —Å–∫–æ–ª—å–∫–æ –∏ `map[T]bool`. –ù–∞ –∑–Ω–∞—á–µ–Ω–∏—è—Ö –±–æ–ª—å—à–µ –Ω–µ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å.

–í —Å—Ç–∞—Ä—ã—Ö –∫–∞—Ä—Ç–∞—Ö –∑–Ω–∞—á–µ–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—Å—å –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –∫–ª—é—á–µ–π: –≤ –∫–∞–∂–¥–æ–º –±–∞–∫–µ—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –≤—Å–µ –∫–ª—é—á–∏, –ø–æ—Ç–æ–º –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è:
```
[K1, K2... K8] [V1, V2... V8]
```
–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –≤–∏–¥–µ–ª struct{}, –∏ –Ω–µ –≤—ã–¥–µ–ª—è–ª –ø–æ–¥ –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞–º—è—Ç—å.

–í –Ω–æ–≤—ã—Ö –∫–∞—Ä—Ç–∞—Ö –∫–ª—é—á–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –≤ –æ–¥–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É (—Å–ª–æ—Ç):
```
[ {K1, V1}, {K2, V2}, ... ]
```
–í–Ω—É—Ç—Ä–∏ —Å–ª–æ—Ç –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
```go
struct {
  key  keyType
  elem elemType
}
```
–ü–æ –ø—Ä–∞–≤–∏–ª–∞–º –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞, –µ—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –ø–æ–ª–µ–º –Ω—É–ª–µ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞, —ç—Ç–æ–º—É –ø–æ–ª—é –≤—Å–µ —Ä–∞–≤–Ω–æ –≤—ã–¥–µ–ª—è–µ—Ç—Å—è 1 –±–∞–π—Ç (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å –∑–ª–æ–¥–µ–π —Å–æ–∑–¥–∞—Å—Ç –Ω–∞ –Ω–µ–≥–æ —É–∫–∞–∑–∞—Ç–µ–ª—å).

–ê —Ñ–∏–∫—Å-—Ç–æ –∑–Ω–∞–µ—Ç–µ –∫–∞–∫–æ–π? –ü—Ä–æ—Å—Ç–æ –ø–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏ key –∏ elem üòÅ
```go
struct {
  elem elemType
  key keyType
}
```
–¢–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–ª–µ –±—É–¥–µ—Ç –Ω–µ –Ω—É–ª–µ–≤–æ–µ, —Ç–∞–∫ —á—Ç–æ –µ—Å–ª–∏ –∫–ª—é—á 8 –±–∞–π—Ç, —Ç–æ –∏ –≤—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–æ–∂–µ 8 –±–∞–π—Ç.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø–æ–ª–µ elem —Ç–∏–ø–∞ struct{} –±—É–¥–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å 1 –±–∞–π—Ç ‚Äî —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ, –∫–∞–∫ bool. –ê –≤–µ—Å—å —Å–ª–æ—Ç ‚Äî –∞–∂ 16 –±–∞–π—Ç, –∏–∑-–∑–∞ [struct#Padding](struct#Padding.md).

[Source](https://rushter.com/blog/go-and-hashmaps/)
[Issue](https://github.com/golang/go/issues/71368) 